import React, { useState, useMemo } from 'react';
import { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer, BarChart, Bar } from 'recharts';
import { ChevronDown, ChevronUp, Download, TrendingUp, Calculator, FileText, BarChart3 } from 'lucide-react';

const BilancioDashboard = () => {
  const [activeTab, setActiveTab] = useState('bilanci');
  const [selectedYears, setSelectedYears] = useState(['2018', '2019', '2020', '2021', '2022']);
  const [expandedExplanations, setExpandedExplanations] = useState({});

  // Dati bilancio della Farmacia De Donno
  const bilanciData = {
    2018: {
      ricavi: 3309088.36,
      costiMateriePrime: 2470143.95,
      costiServizi: 147601.19,
      costiPersonale: 364594.50,
      ebitda: 349752.84,
      ebit: 236283.96,
      utileNetto: 196830.74,
      totaleAttivo: 1485573.82,
      patrimonioNetto: -245380.66,
      debiti: 1627605.40,
      disponibilitaLiquide: 34441.01,
      creditiBreveTermine: 338604.22,
      debitiBreveTermine: 1028265.04,
      immobilizzazioni: 446653.51,
      capitale: 300000
    },
    2019: {
      ricavi: 3366178.45,
      costiMateriePrime: 2445141.12,
      costiServizi: 140795.63,
      costiPersonale: 412476.08,
      ebitda: 304494.49,
      ebit: 179494.28,
      utileNetto: 108728.00,
      totaleAttivo: 1775803.14,
      patrimonioNetto: -39874.67,
      debiti: 1718380.97,
      disponibilitaLiquide: 43763.96,
      creditiBreveTermine: 377666.17,
      debitiBreveTermine: 978439.25,
      immobilizzazioni: 662935.12,
      capitale: 300000
    },
    2020: {
      ricavi: 2990942.51,
      costiMateriePrime: 2163702.64,
      costiServizi: 108049.90,
      costiPersonale: 311994.55,
      ebitda: 331901.82,
      ebit: 331901.82,
      utileNetto: 265749.73,
      totaleAttivo: 1822729.95,
      patrimonioNetto: 66495.06,
      debiti: 1639353.32,
      disponibilitaLiquide: 30375.06,
      creditiBreveTermine: 425190.50,
      debitiBreveTermine: 988019.58,
      immobilizzazioni: 689042.80,
      capitale: 300000
    },
    2021: {
      ricavi: 3417154.76,
      costiMateriePrime: 2429442.44,
      costiServizi: 129159.43,
      costiPersonale: 316873.39,
      ebitda: 331034.54,
      ebit: 201342.87,
      utileNetto: 142289.65,
      totaleAttivo: 1681933.20,
      patrimonioNetto: -8553.15,
      debiti: 1566440.57,
      disponibilitaLiquide: 140490.33,
      creditiBreveTermine: 427639.16,
      debitiBreveTermine: 698948.32,
      immobilizzazioni: 584204.65,
      capitale: 300000
    },
    2022: {
      ricavi: 3705919.37,
      costiMateriePrime: 2389835.66,
      costiServizi: 156181.88,
      costiPersonale: 398371.74,
      ebitda: 507768.65,
      ebit: 408309.91,
      utileNetto: 355752.72,
      totaleAttivo: 1625391.93,
      patrimonioNetto: -4536.18,
      debiti: 1556542.10,
      disponibilitaLiquide: 207194.23,
      creditiBreveTermine: 506680.43,
      debitiBreveTermine: 769551.41,
      immobilizzazioni: 533920.64,
      capitale: 300000
    }
  };

  // Calcolo degli indici
  const calcolaIndici = () => {
    const indici = {};
    
    Object.keys(bilanciData).forEach(anno => {
      const data = bilanciData[anno];
      
      // Indici Economici
      const roi = (data.ebit / data.totaleAttivo) * 100;
      const roa = (data.utileNetto / data.totaleAttivo) * 100;
      const ros = (data.utileNetto / data.ricavi) * 100;
      const ebitdaMargin = (data.ebitda / data.ricavi) * 100;
      
      // Indici Finanziari
      const currentRatio = data.debitiBreveTermine > 0 ? (data.creditiBreveTermine + data.disponibilitaLiquide) / data.debitiBreveTermine : 0;
      const quickRatio = data.debitiBreveTermine > 0 ? data.disponibilitaLiquide / data.debitiBreveTermine : 0;
      const debtToEquity = data.patrimonioNetto > 0 ? data.debiti / data.patrimonioNetto : 0;
      
      // Indici Patrimoniali
      const autonomiaFinanziaria = data.patrimonioNetto > 0 ? (data.patrimonioNetto / data.totaleAttivo) * 100 : 0;
      const coperturaImmobilizzazioni = data.immobilizzazioni > 0 ? (data.patrimonioNetto / data.immobilizzazioni) * 100 : 0;
      const composizioneAttivo = (data.immobilizzazioni / data.totaleAttivo) * 100;
      
      indici[anno] = {
        roi, roa, ros, ebitdaMargin,
        currentRatio, quickRatio, debtToEquity,
        autonomiaFinanziaria, coperturaImmobilizzazioni, composizioneAttivo
      };
    });
    
    return indici;
  };

  const indici = calcolaIndici();

  // Preparazione dati per i grafici
  const chartData = useMemo(() => {
    return selectedYears.map(year => ({
      anno: year,
      ...bilanciData[year],
      ...indici[year]
    }));
  }, [selectedYears]);

  const toggleExplanation = (key) => {
    setExpandedExplanations(prev => ({
      ...prev,
      [key]: !prev[key]
    }));
  };

  const explanations = {
    ebitda: "EBITDA (Earnings Before Interest, Taxes, Depreciation and Amortization) rappresenta il margine operativo lordo, ovvero la capacità dell'azienda di generare ricchezza dalla sua attività operativa, prima di considerare ammortamenti, interessi e tasse.",
    roi: "ROI (Return on Investment) misura la redditività del capitale investito. Indica quanto rende ogni euro investito nell'azienda.",
    roa: "ROA (Return on Assets) misura la redditività del totale attivo. Indica quanto utile genera ogni euro di attività investita, indipendentemente dalla struttura finanziaria.",
    ros: "ROS (Return on Sales) misura la redditività delle vendite. Indica quanto utile genera ogni euro di fatturato.",
    currentRatio: "Current Ratio misura la liquidità corrente. Indica la capacità dell'azienda di far fronte ai debiti a breve termine con le attività correnti.",
    quickRatio: "Quick Ratio misura la liquidità immediata. Indica la capacità di pagare i debiti a breve usando solo le disponibilità liquide.",
    debtToEquity: "Debt to Equity Ratio misura il rapporto tra debiti e patrimonio netto. Indica il livello di indebitamento rispetto ai mezzi propri.",
    autonomiaFinanziaria: "Autonomia Finanziaria indica la percentuale di attività finanziate con mezzi propri.",
    coperturaImmobilizzazioni: "Copertura Immobilizzazioni indica se le immobilizzazioni sono finanziate con capitale proprio.",
    composizioneAttivo: "Composizione Attivo indica la percentuale di immobilizzazioni sul totale attivo."
  };

  const formatCurrency = (value) => {
    return new Intl.NumberFormat('it-IT', {
      style: 'currency',
      currency: 'EUR',
      minimumFractionDigits: 0,
      maximumFractionDigits: 0
    }).format(value);
  };

  const formatPercentage = (value) => {
    return `${value.toFixed(2)}%`;
  };

  const renderBilanci = () => (
    <div className="space-y-6">
      <div className="flex flex-wrap gap-2 mb-4">
        {Object.keys(bilanciData).map(year => (
          <label key={year} className="flex items-center space-x-2">
            <input
              type="checkbox"
              checked={selectedYears.includes(year)}
              onChange={(e) => {
                if (e.target.checked) {
                  setSelectedYears([...selectedYears, year]);
                } else {
                  setSelectedYears(selectedYears.filter(y => y !== year));
                }
              }}
              className="rounded"
            />
            <span className="text-sm font-medium">{year}</span>
          </label>
        ))}
      </div>

      <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <div className="bg-white p-6 rounded-lg shadow-lg">
          <h3 className="text-lg font-bold mb-4 text-blue-800">Principali Voci Economiche</h3>
          <div className="overflow-x-auto">
            <table className="w-full text-sm">
              <thead>
                <tr className="border-b">
                  <th className="text-left py-2">Voce</th>
                  {selectedYears.map(year => (
                    <th key={year} className="text-right py-2">{year}</th>
                  ))}
                </tr>
              </thead>
              <tbody>
                <tr className="border-b">
                  <td className="py-2 font-medium">Ricavi</td>
                  {selectedYears.map(year => (
                    <td key={year} className="text-right py-2">{formatCurrency(bilanciData[year].ricavi)}</td>
                  ))}
                </tr>
                <tr className="border-b">
                  <td className="py-2 font-medium">Costi Materie Prime</td>
                  {selectedYears.map(year => (
                    <td key={year} className="text-right py-2">{formatCurrency(bilanciData[year].costiMateriePrime)}</td>
                  ))}
                </tr>
                <tr className="border-b">
                  <td className="py-2 font-medium">Costi Servizi</td>
                  {selectedYears.map(year => (
                    <td key={year} className="text-right py-2">{formatCurrency(bilanciData[year].costiServizi)}</td>
                  ))}
                </tr>
                <tr className="border-b">
                  <td className="py-2 font-medium">Costi Personale</td>
                  {selectedYears.map(year => (
                    <td key={year} className="text-right py-2">{formatCurrency(bilanciData[year].costiPersonale)}</td>
                  ))}
                </tr>
                <tr className="border-b bg-green-50">
                  <td className="py-2 font-bold">EBITDA</td>
                  {selectedYears.map(year => (
                    <td key={year} className="text-right py-2 font-bold">{formatCurrency(bilanciData[year].ebitda)}</td>
                  ))}
                </tr>
                <tr className="border-b bg-blue-50">
                  <td className="py-2 font-bold">Utile Netto</td>
                  {selectedYears.map(year => (
                    <td key={year} className="text-right py-2 font-bold">{formatCurrency(bilanciData[year].utileNetto)}</td>
                  ))}
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <div className="bg-white p-6 rounded-lg shadow-lg">
          <h3 className="text-lg font-bold mb-4 text-blue-800">Principali Voci Patrimoniali</h3>
          <div className="overflow-x-auto">
            <table className="w-full text-sm">
              <thead>
                <tr className="border-b">
                  <th className="text-left py-2">Voce</th>
                  {selectedYears.map(year => (
                    <th key={year} className="text-right py-2">{year}</th>
                  ))}
                </tr>
              </thead>
              <tbody>
                <tr className="border-b">
                  <td className="py-2 font-medium">Totale Attivo</td>
                  {selectedYears.map(year => (
                    <td key={year} className="text-right py-2">{formatCurrency(bilanciData[year].totaleAttivo)}</td>
                  ))}
                </tr>
                <tr className="border-b">
                  <td className="py-2 font-medium">Patrimonio Netto</td>
                  {selectedYears.map(year => (
                    <td key={year} className="text-right py-2">{formatCurrency(bilanciData[year].patrimonioNetto)}</td>
                  ))}
                </tr>
                <tr className="border-b">
                  <td className="py-2 font-medium">Debiti Totali</td>
                  {selectedYears.map(year => (
                    <td key={year} className="text-right py-2">{formatCurrency(bilanciData[year].debiti)}</td>
                  ))}
                </tr>
                <tr className="border-b">
                  <td className="py-2 font-medium">Disponibilità Liquide</td>
                  {selectedYears.map(year => (
                    <td key={year} className="text-right py-2">{formatCurrency(bilanciData[year].disponibilitaLiquide)}</td>
                  ))}
                </tr>
                <tr className="border-b">
                  <td className="py-2 font-medium">Immobilizzazioni</td>
                  {selectedYears.map(year => (
                    <td key={year} className="text-right py-2">{formatCurrency(bilanciData[year].immobilizzazioni)}</td>
                  ))}
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  );

  const renderGrafici = () => (
    <div className="space-y-8">
      <div className="bg-white p-6 rounded-lg shadow-lg">
        <h3 className="text-lg font-bold mb-4 text-blue-800">Trend Ricavi e Marginalità</h3>
        <ResponsiveContainer width="100%" height={400}>
          <LineChart data={chartData}>
            <CartesianGrid strokeDasharray="3 3" />
            <XAxis dataKey="anno" />
            <YAxis />
            <Tooltip formatter={(value) => formatCurrency(value)} />
            <Legend />
            <Line type="monotone" dataKey="ricavi" stroke="#2563eb" strokeWidth={3} name="Ricavi" />
            <Line type="monotone" dataKey="ebitda" stroke="#059669" strokeWidth={3} name="EBITDA" />
            <Line type="monotone" dataKey="utileNetto" stroke="#dc2626" strokeWidth={3} name="Utile Netto" />
          </LineChart>
        </ResponsiveContainer>
      </div>

      <div className="bg-white p-6 rounded-lg shadow-lg">
        <h3 className="text-lg font-bold mb-4 text-blue-800">Composizione Costi</h3>
        <ResponsiveContainer width="100%" height={400}>
          <BarChart data={chartData}>
            <CartesianGrid strokeDasharray="3 3" />
            <XAxis dataKey="anno" />
            <YAxis />
            <Tooltip formatter={(value) => formatCurrency(value)} />
            <Legend />
            <Bar dataKey="costiMateriePrime" stackId="a" fill="#ef4444" name="Costi Materie Prime" />
            <Bar dataKey="costiServizi" stackId="a" fill="#f97316" name="Costi Servizi" />
            <Bar dataKey="costiPersonale" stackId="a" fill="#eab308" name="Costi Personale" />
          </BarChart>
        </ResponsiveContainer>
      </div>

      <div className="bg-white p-6 rounded-lg shadow-lg">
        <h3 className="text-lg font-bold mb-4 text-blue-800">Struttura Patrimoniale</h3>
        <ResponsiveContainer width="100%" height={400}>
          <LineChart data={chartData}>
            <CartesianGrid strokeDasharray="3 3" />
            <XAxis dataKey="anno" />
            <YAxis />
            <Tooltip formatter={(value) => formatCurrency(value)} />
            <Legend />
            <Line type="monotone" dataKey="totaleAttivo" stroke="#2563eb" strokeWidth={3} name="Totale Attivo" />
            <Line type="monotone" dataKey="debiti" stroke="#dc2626" strokeWidth={3} name="Debiti Totali" />
            <Line type="monotone" dataKey="disponibilitaLiquide" stroke="#059669" strokeWidth={3} name="Liquidità" />
          </LineChart>
        </ResponsiveContainer>
      </div>
    </div>
  );

  const renderIndici = () => (
    <div className="space-y-8">
      {/* Indici Economici */}
      <div className="bg-white p-6 rounded-lg shadow-lg">
        <h3 className="text-lg font-bold mb-4 text-blue-800">Indici di Redditività</h3>
        
        <div className="mb-6">
          <div className="flex items-center justify-between mb-2">
            <h4 className="font-medium">EBITDA Margin</h4>
            <button 
              onClick={() => toggleExplanation('ebitda')}
              className="text-blue-600 hover:text-blue-800"
            >
              {expandedExplanations.ebitda ? <ChevronUp size={16} /> : <ChevronDown size={16} />}
            </button>
          </div>
          {expandedExplanations.ebitda && (
            <div className="bg-blue-50 p-3 rounded mb-3 text-sm">
              {explanations.ebitda}
            </div>
          )}
          <div className="overflow-x-auto">
            <table className="w-full text-sm">
              <thead>
                <tr className="border-b">
                  {selectedYears.map(year => (
                    <th key={year} className="text-center py-2">{year}</th>
                  ))}
                </tr>
              </thead>
              <tbody>
                <tr>
                  {selectedYears.map(year => (
                    <td key={year} className="text-center py-2 font-medium">
                      {formatPercentage(indici[year].ebitdaMargin)}
                    </td>
                  ))}
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
          {['roi', 'roa', 'ros'].map(indice => (
            <div key={indice} className="border rounded p-4">
              <div className="flex items-center justify-between mb-2">
                <h4 className="font-medium">{indice.toUpperCase()}</h4>
                <button 
                  onClick={() => toggleExplanation(indice)}
                  className="text-blue-600 hover:text-blue-800"
                >
                  {expandedExplanations[indice] ? <ChevronUp size={16} /> : <ChevronDown size={16} />}
                </button>
              </div>
              {expandedExplanations[indice] && (
                <div className="bg-blue-50 p-3 rounded mb-3 text-sm">
                  {explanations[indice]}
                </div>
              )}
              <div className="space-y-1">
                {selectedYears.map(year => (
                  <div key={year} className="flex justify-between text-sm">
                    <span>{year}:</span>
                    <span className="font-medium">{formatPercentage(indici[year][indice])}</span>
                  </div>
                ))}
              </div>
            </div>
          ))}
        </div>

        {/* Grafico Trend Indici di Redditività */}
        <div className="mt-6">
          <h4 className="text-md font-bold mb-4 text-gray-700">Trend Indici di Redditività</h4>
          <ResponsiveContainer width="100%" height={300}>
            <LineChart data={chartData}>
              <CartesianGrid strokeDasharray="3 3" />
              <XAxis dataKey="anno" />
              <YAxis />
              <Tooltip formatter={(value) => `${value.toFixed(2)}%`} />
              <Legend />
              <Line type="monotone" dataKey="ebitdaMargin" stroke="#059669" strokeWidth={3} name="EBITDA Margin" />
              <Line type="monotone" dataKey="roi" stroke="#2563eb" strokeWidth={3} name="ROI" />
              <Line type="monotone" dataKey="roa" stroke="#f59e0b" strokeWidth={3} name="ROA" />
              <Line type="monotone" dataKey="ros" stroke="#dc2626" strokeWidth={3} name="ROS" />
            </LineChart>
          </ResponsiveContainer>
        </div>
      </div>

      {/* Indici Finanziari */}
      <div className="bg-white p-6 rounded-lg shadow-lg">
        <h3 className="text-lg font-bold mb-4 text-blue-800">Indici Finanziari</h3>
        <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
          {['currentRatio', 'quickRatio', 'debtToEquity'].map(indice => (
            <div key={indice} className="border rounded p-4">
              <div className="flex items-center justify-between mb-2">
                <h4 className="font-medium">{
                  indice === 'currentRatio' ? 'Current Ratio' :
                  indice === 'quickRatio' ? 'Quick Ratio' :
                  'Debt/Equity'
                }</h4>
                <button 
                  onClick={() => toggleExplanation(indice)}
                  className="text-blue-600 hover:text-blue-800"
                >
                  {expandedExplanations[indice] ? <ChevronUp size={16} /> : <ChevronDown size={16} />}
                </button>
              </div>
              {expandedExplanations[indice] && (
                <div className="bg-blue-50 p-3 rounded mb-3 text-sm">
                  {explanations[indice]}
                </div>
              )}
              <div className="space-y-1">
                {selectedYears.map(year => (
                  <div key={year} className="flex justify-between text-sm">
                    <span>{year}:</span>
                    <span className="font-medium">{indici[year][indice].toFixed(2)}</span>
                  </div>
                ))}
              </div>
            </div>
          ))}
        </div>

        {/* Grafico Trend Indici Finanziari */}
        <div className="mt-6">
          <h4 className="text-md font-bold mb-4 text-gray-700">Trend Indici Finanziari</h4>
          <ResponsiveContainer width="100%" height={300}>
            <LineChart data={chartData}>
              <CartesianGrid strokeDasharray="3 3" />
              <XAxis dataKey="anno" />
              <YAxis />
              <Tooltip formatter={(value) => value.toFixed(2)} />
              <Legend />
              <Line type="monotone" dataKey="currentRatio" stroke="#10b981" strokeWidth={3} name="Current Ratio" />
              <Line type="monotone" dataKey="quickRatio" stroke="#3b82f6" strokeWidth={3} name="Quick Ratio" />
              <Line type="monotone" dataKey="debtToEquity" stroke="#ef4444" strokeWidth={3} name="Debt/Equity" />
            </LineChart>
          </ResponsiveContainer>
        </div>
      </div>

      {/* Indici Patrimoniali */}
      <div className="bg-white p-6 rounded-lg shadow-lg">
        <h3 className="text-lg font-bold mb-4 text-blue-800">Indici Patrimoniali</h3>
        <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
          {['autonomiaFinanziaria', 'coperturaImmobilizzazioni', 'composizioneAttivo'].map(indice => (
            <div key={indice} className="border rounded p-4">
              <div className="flex items-center justify-between mb-2">
                <h4 className="font-medium">{
                  indice === 'autonomiaFinanziaria' ? 'Autonomia Finanziaria' :
                  indice === 'coperturaImmobilizzazioni' ? 'Copertura Immobilizzazioni' :
                  'Composizione Attivo'
                }</h4>
                <button 
                  onClick={() => toggleExplanation(indice)}
                  className="text-blue-600 hover:text-blue-800"
                >
                  {expandedExplanations[indice] ? <ChevronUp size={16} /> : <ChevronDown size={16} />}
                </button>
              </div>
              {expandedExplanations[indice] && (
                <div className="bg-blue-50 p-3 rounded mb-3 text-sm">
                  {explanations[indice]}
                </div>
              )}
              <div className="space-y-1">
                {selectedYears.map(year => (
                  <div key={year} className="flex justify-between text-sm">
                    <span>{year}:</span>
                    <span className="font-medium">{formatPercentage(indici[year][indice])}</span>
                  </div>
                ))}
              </div>
            </div>
          ))}
        </div>

        {/* Grafico Trend Indici Patrimoniali */}
        <div className="mt-6">
          <h4 className="text-md font-bold mb-4 text-gray-700">Trend Indici Patrimoniali</h4>
          <ResponsiveContainer width="100%" height={300}>
            <LineChart data={chartData}>
              <CartesianGrid strokeDasharray="3 3" />
              <XAxis dataKey="anno" />
              <YAxis />
              <Tooltip formatter={(value) => `${value.toFixed(2)}%`} />
              <Legend />
              <Line type="monotone" dataKey="autonomiaFinanziaria" stroke="#8b5cf6" strokeWidth={3} name="Autonomia Finanziaria" />
              <Line type="monotone" dataKey="coperturaImmobilizzazioni" stroke="#f97316" strokeWidth={3} name="Copertura Immobilizzazioni" />
              <Line type="monotone" dataKey="composizioneAttivo" stroke="#06b6d4" strokeWidth={3} name="Composizione Attivo" />
            </LineChart>
          </ResponsiveContainer>
        </div>
      </div>

      {/* Grafici Trend Indici */}
      <div className="bg-white p-6 rounded-lg shadow-lg">
        <h3 className="text-lg font-bold mb-4 text-blue-800">Trend Indici di Redditività</h3>
        <ResponsiveContainer width="100%" height={400}>
          <LineChart data={chartData}>
            <CartesianGrid strokeDasharray="3 3" />
            <XAxis dataKey="anno" />
            <YAxis />
            <Tooltip formatter={(value) => `${value.toFixed(2)}%`} />
            <Legend />
            <Line type="monotone" dataKey="ebitdaMargin" stroke="#059669" strokeWidth={3} name="EBITDA Margin" />
            <Line type="monotone" dataKey="roi" stroke="#2563eb" strokeWidth={3} name="ROI" />
            <Line type="monotone" dataKey="roe" stroke="#f59e0b" strokeWidth={3} name="ROE" />
            <Line type="monotone" dataKey="ros" stroke="#dc2626" strokeWidth={3} name="ROS" />
          </LineChart>
        </ResponsiveContainer>
      </div>

      <div className="bg-white p-6 rounded-lg shadow-lg">
        <h3 className="text-lg font-bold mb-4 text-blue-800">Trend Indici Finanziari</h3>
        <ResponsiveContainer width="100%" height={400}>
          <LineChart data={chartData}>
            <CartesianGrid strokeDasharray="3 3" />
            <XAxis dataKey="anno" />
            <YAxis />
            <Tooltip formatter={(value) => value.toFixed(2)} />
            <Legend />
            <Line type="monotone" dataKey="currentRatio" stroke="#10b981" strokeWidth={3} name="Current Ratio" />
            <Line type="monotone" dataKey="quickRatio" stroke="#3b82f6" strokeWidth={3} name="Quick Ratio" />
            <Line type="monotone" dataKey="debtToEquity" stroke="#ef4444" strokeWidth={3} name="Debt/Equity" />
          </LineChart>
        </ResponsiveContainer>
      </div>

      <div className="bg-white p-6 rounded-lg shadow-lg">
        <h3 className="text-lg font-bold mb-4 text-blue-800">Trend Indici Patrimoniali</h3>
        <ResponsiveContainer width="100%" height={400}>
          <LineChart data={chartData}>
            <CartesianGrid strokeDasharray="3 3" />
            <XAxis dataKey="anno" />
            <YAxis />
            <Tooltip formatter={(value) => `${value.toFixed(2)}%`} />
            <Legend />
            <Line type="monotone" dataKey="autonomiaFinanziaria" stroke="#8b5cf6" strokeWidth={3} name="Autonomia Finanziaria" />
            <Line type="monotone" dataKey="coperturaImmobilizzazioni" stroke="#f97316" strokeWidth={3} name="Copertura Immobilizzazioni" />
            <Line type="monotone" dataKey="composizioneAttivo" stroke="#06b6d4" strokeWidth={3} name="Composizione Attivo" />
          </LineChart>
        </ResponsiveContainer>
      </div>
    </div>
  );

  const exportToPDF = () => {
    // Funzione placeholder per l'export PDF
    alert('Funzione di export PDF in sviluppo. Utilizzare la funzione di stampa del browser per ora.');
    window.print();
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100">
      <div className="container mx-auto p-6">
        {/* Header */}
        <div className="bg-white rounded-lg shadow-lg p-6 mb-6">
          <div className="flex justify-between items-center">
            <div>
              <h1 className="text-3xl font-bold text-blue-900">Prova Claude</h1>
              <p className="text-gray-600 mt-2">Analisi di Bilancio e Merito Creditizio 2018-2022</p>
            </div>
            <button
              onClick={exportToPDF}
              className="flex items-center space-x-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors"
            >
              <Download size={20} />
              <span>Esporta PDF</span>
            </button>
          </div>
        </div>

        {/* Navigation Tabs */}
        <div className="flex space-x-1 mb-6">
          {[
            { id: 'bilanci', label: 'Bilanci', icon: FileText },
            { id: 'grafici', label: 'Grafici', icon: BarChart3 },
            { id: 'indici', label: 'Indici', icon: Calculator }
          ].map(tab => (
            <button
              key={tab.id}
              onClick={() => setActiveTab(tab.id)}
              className={`flex items-center space-x-2 px-6 py-3 rounded-lg font-medium transition-colors ${
                activeTab === tab.id
                  ? 'bg-blue-600 text-white'
                  : 'bg-white text-gray-700 hover:bg-gray-100'
              }`}
            >
              <tab.icon size={20} />
              <span>{tab.label}</span>
            </button>
          ))}
        </div>

        {/* Content */}
        <div className="min-h-96">
          {activeTab === 'bilanci' && renderBilanci()}
          {activeTab === 'grafici' && renderGrafici()}
          {activeTab === 'indici' && renderIndici()}
        </div>
      </div>
    </div>
  );
};

export default BilancioDashboard;